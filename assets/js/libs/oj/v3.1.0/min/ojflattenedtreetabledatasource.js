/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(a,g){a.Pb=function(c,b){b=b||{};if(!(c instanceof a.Ca))throw Error(a.ha.Pd._ERR_DATA_INVALID_TYPE_SUMMARY+"\n"+a.ha.Pd._ERR_DATA_INVALID_TYPE_DETAIL);this.p=c;this.qf=[];this.Aa=0;this.Ui=[];this.Io=!0;null==this.p.KI("fetchSize")&&(this.p.wn=function(){return-1});var d=this;this.p.cR=function(b,c,g){var k,l,m,p,t=[],s=[],n=[];for(c=0;c<g.getCount();c++){l=g.getData(c);p=g.getMetadata(c).key;m=b+c;d.Ui.splice(m,0,{});d.Ui[m].nodeSet=
g;d.Ui[m].startIndex=b;for(k=m+1;k<d.Ui.length;k++)d.Ui[k].startIndex+=1;t.push(d.qn(l));s.push(p);n.push(m);d.Oa.data.splice(m,0,l);d.Oa.keys.splice(m,0,p);d.Oa.indexes.splice(m,0,m)}d.uH();d.Io=!0;a.ha.O.handleEvent.call(d,a.ha.aa.ADD,{data:t,keys:s,indexes:n})};this.p.iS=function(b){var c,g,k,l=[],m=[],p=[];for(c=b.length-1;0<=c;c--){k=b[c].index;l.push("");m.push("");p.push(k);d.Ui.splice(k,1);for(g=k;g<d.Ui.length;g++)d.Ui[g].startIndex-=1;d.Oa.data.splice(k,1);d.Oa.keys.splice(k,1);d.Oa.indexes.splice(k,
1)}p=p.sort(function(a,b){return a-b});d.uH();d.Io=!0;a.ha.O.handleEvent.call(d,a.ha.aa.REMOVE,{data:l,keys:m,indexes:p})};this.Init();if(null!=b&&("enabled"==b.startFetch||null==b.startFetch)||null==b)this.YH=!0};o_("FlattenedTreeTableDataSource",a.Pb,a);a.f.xa(a.Pb,a.ha,"oj.FlattenedTreeTableDataSource");a.Pb.prototype.Init=function(){a.Pb.O.Init.call(this)};a.f.j("FlattenedTreeTableDataSource.prototype.Init",{Init:a.Pb.prototype.Init});a.Pb.prototype.getCapability=function(){return"full"};a.f.j("FlattenedTreeTableDataSource.prototype.getCapability",
{getCapability:a.Pb.prototype.getCapability});a.Pb.prototype.getWrappedDataSource=function(){return this.p};a.f.j("FlattenedTreeTableDataSource.prototype.getWrappedDataSource",{getWrappedDataSource:a.Pb.prototype.getWrappedDataSource});a.Pb.prototype.fetch=function(a){a=a||{};return"init"!=a.fetchType||this.YH?this.xh(a):Promise.resolve()};a.f.j("FlattenedTreeTableDataSource.prototype.fetch",{fetch:a.Pb.prototype.fetch});a.Pb.prototype.at=function(a){var b;b=0>a||a>=this.Oa.data.length?null:{data:this.Oa.data[a],
index:a,key:this.Oa.keys[a]};return new Promise(function(a){a(b)})};a.f.j("FlattenedTreeTableDataSource.prototype.at",{at:a.Pb.prototype.at});a.Pb.prototype.collapse=function(a){this.p.collapse(a)};a.f.j("FlattenedTreeTableDataSource.prototype.collapse",{collapse:a.Pb.prototype.collapse});a.Pb.prototype.expand=function(a){this.p.expand(a)};a.f.j("FlattenedTreeTableDataSource.prototype.expand",{expand:a.Pb.prototype.expand});a.Pb.prototype.get=function(a){var b=this.p.rm(Object(a));a={data:this.qn(this.Oa.data[b]),
key:a,index:b};return Promise.resolve(a)};a.f.j("FlattenedTreeTableDataSource.prototype.get",{get:a.Pb.prototype.get});a.Pb.prototype.on=function(c,b){if("expand"==c||"collapse"==c)this.p.on(c,b);else a.Pb.O.on.call(this,c,b)};a.f.j("FlattenedTreeTableDataSource.prototype.on",{on:a.Pb.prototype.on});a.Pb.prototype.off=function(c,b){"expand"==c||"collapse"==c?this.p.off(c,b):a.Pb.O.off.call(this,c,b)};a.f.j("FlattenedTreeTableDataSource.prototype.off",{off:a.Pb.prototype.off});a.Pb.prototype.sort=
function(c){null==c?c=this.sortCriteria:this.sortCriteria=c;var b=this;c.axis="column";return new Promise(function(d,e){b.p.getWrappedDataSource().sort(c,{success:function(){setTimeout(function(){b.p.refresh();b.Oa=null;var e={header:c.key,direction:c.direction};a.ha.O.handleEvent.call(b,a.ha.aa.RESET,null);d(e)},0)}.bind(this),error:function(a){e(a)}.bind(this)})})};a.f.j("FlattenedTreeTableDataSource.prototype.sort",{sort:a.Pb.prototype.sort});a.Pb.prototype.totalSize=function(){return this.Io?
-1:this.Oa.data.length};a.f.j("FlattenedTreeTableDataSource.prototype.totalSize",{totalSize:a.Pb.prototype.totalSize});a.Pb.prototype.totalSizeConfidence=function(){return this.Io?"unknown":"actual"};a.f.j("FlattenedTreeTableDataSource.prototype.totalSizeConfidence",{totalSizeConfidence:a.Pb.prototype.totalSizeConfidence});a.Pb.prototype.lG=function(a){var b=this.Ui[a].nodeSet.getStart();return this.Ui[a].nodeSet.getMetadata(b+a-this.Ui[a].startIndex)};a.Pb.prototype.xh=function(c){c=c||{};this.XH(c);
this.Aa=null==c.startIndex?this.Aa:c.startIndex;var b=Number.MAX_VALUE;this.Bb=null==c.pageSize?this.Bb:c.pageSize;null!=this.Bb&&(b=this.Bb);var d=this.Aa;if(null!=this.Oa)if(null!=this.Bb){var e=this.Oa.data.length-1;if(this.Aa+this.Bb-1<=e){var e=a.Pb.jN(this.Oa,this.Aa,this.Bb),b=[],d=[],f,g;for(f=this.Aa;f<=e;f++)g=this.Oa.keys[f],b[f-this.Aa]=this.qn(this.Oa.data[f]),d[f-this.Aa]=g;e={data:b,keys:d,startIndex:this.Aa};this.Bo(c,e,null);return Promise.resolve(e)}this.Aa<=e&&(d=e+1)}else this.p.refresh(),
this.Oa=null;else d=0;var k={start:d,count:b},l=this;return new Promise(function(b,d){l.p.Uq(k,{success:function(d){l.pZ(d);c.refresh=!0;d=a.Pb.jN(l.Oa,l.Aa,l.Bb);var e=[],f=[],g,h;for(g=l.Aa;g<=d;g++)h=l.Oa.keys[g],e[g-l.Aa]=l.qn(l.Oa.data[g]),f[g-l.Aa]=h;l.Io=0<e.length?null!=l.Bb&&e.length<l.Bb?!1:!0:!1;d={data:e,keys:f,startIndex:l.Aa};l.Bo(c,d,null);b(d)}.bind(this),error:function(a){l.Bo(c,null,a);d(a)}.bind(this)})})};a.Pb.prototype.pZ=function(c){var b=c.getStart(),d,e;for(d=0;d<c.getCount();d++)e=
b+d,this.Ui[e]={},this.Ui[e].nodeSet=c,this.Ui[e].startIndex=b;this.Oa||(this.Oa={},this.Oa.data=[],this.Oa.keys=[],this.Oa.indexes=[]);a.Pb.zB(c,this,this.Oa,b)};a.Pb.prototype.XH=function(c){c.silent||a.ha.O.handleEvent.call(this,a.ha.aa.REQUEST,{startIndex:c.startIndex})};a.Pb.prototype.Bo=function(c,b,d){null!=d?a.ha.O.handleEvent.call(this,a.ha.aa.ERROR,d):c.silent||a.ha.O.handleEvent.call(this,a.ha.aa.SYNC,b)};a.Pb.jN=function(a,b,d){var e=a.data.length-1;0<d&&(e=b+d-1,e=e>a.data.length-1?a.data.length-
1:e);return e};a.Pb.zB=function(a,b,d,e){for(b=0;b<a.getCount();b++){var f=a.getData(a.getStart()+b);d.data[e+b]=f;d.keys[e+b]=a.getMetadata(a.getStart()+b).key;d.indexes[e+b]=e+b}};a.Pb.prototype.uH=function(){for(var a=0;a<this.Oa.data.length;a++)this.Oa.indexes[a]=a};a.Pb.prototype.qn=function(c){var b=g.extend(!0,{},c),d,e=Object.keys(c);for(d=0;d<e.length;d++)a.Pb.XW(b,c,e[d]);return b};a.Pb.XW=function(a,b,d){Object.defineProperty(a,d,{get:function(){return b[d]},set:function(a){b[d]=a},enumerable:!0})}});