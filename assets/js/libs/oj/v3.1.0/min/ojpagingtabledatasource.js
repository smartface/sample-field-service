/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(a){a.Na=function(g){if(!(g instanceof a.ha))throw Error(a.ha.Pd._ERR_DATA_INVALID_TYPE_SUMMARY+"\n"+a.ha.Pd._ERR_DATA_INVALID_TYPE_DETAIL);this.Sd=g;this.Aa=0;this.Zl=-1;this.hs=[];this.Init();Object.defineProperty(this,"sortCriteria",{configurable:!1,enumerable:!0,get:function(){return this.Sd.sortCriteria},set:function(a){this.Sd.sortCriteria=a}})};o_("PagingTableDataSource",a.Na,a);a.f.xa(a.Na,a.ha,"oj.PagingTableDataSource");a.Na.prototype.Init=
function(){a.Na.O.Init.call(this)};a.f.j("PagingTableDataSource.prototype.Init",{Init:a.Na.prototype.Init});a.Na.prototype.getWrappedDataSource=function(){return this.Sd};a.f.j("PagingTableDataSource.prototype.getWrappedDataSource",{getWrappedDataSource:a.Na.prototype.getWrappedDataSource});a.Na.prototype.getPage=function(){return"loadMore"==this.SF?0:this.uN()};a.f.j("PagingTableDataSource.prototype.getPage",{getPage:a.Na.prototype.getPage});a.Na.prototype.setPage=function(g,c){c=c||{};g=parseInt(g,
10);try{a.Na.O.handleEvent.call(this,a.zd.aa.BEFOREPAGE,{page:g,previousPage:this.uN()})}catch(b){return Promise.reject(b)}var d=this.uN();this.Bb=null!=c.pageSize?c.pageSize:this.Bb;c.pageSize=this.Bb;c.startIndex=g*this.Bb;this.Aa=null==c.startIndex?this.Aa:c.startIndex;this.SF="page";var e=this;return new Promise(function(b,g){0<e.Bb?e.Sd.fetch(c).then(function(c){c.startIndex=0;0<c.data.length?e.Uy(e.Aa+c.data.length-1,!0):e.Uy(-1,!0);a.Na.O.handleEvent.call(e,a.zd.aa.PAGE,{page:e.uN(),previousPage:d});
b(null)},function(a){e.Aa=d*e.Bb;g(a)}):b(null)})};a.f.j("PagingTableDataSource.prototype.setPage",{setPage:a.Na.prototype.setPage});a.Na.prototype.getStartItemIndex=function(){return"loadMore"==this.SF?0:this.Aa};a.f.j("PagingTableDataSource.prototype.getStartItemIndex",{getStartItemIndex:a.Na.prototype.getStartItemIndex});a.Na.prototype.getEndItemIndex=function(){return this.Zl};a.f.j("PagingTableDataSource.prototype.getEndItemIndex",{getEndItemIndex:a.Na.prototype.getEndItemIndex});a.Na.prototype.getPageCount=
function(){var a=this.totalSize();return-1==a?-1:Math.ceil(a/this.Bb)};a.f.j("PagingTableDataSource.prototype.getPageCount",{getPageCount:a.Na.prototype.getPageCount});a.Na.prototype.at=function(a,c){return this.Sd.at(a,c)};a.f.j("PagingTableDataSource.prototype.at",{at:a.Na.prototype.at});a.Na.prototype.fetch=function(a){a=a||{};if(null==a.startIndex)return this.setPage(this.getPage());this.SF="loadMore";this.Aa=null==a.startIndex?this.Aa:a.startIndex;var c=null==a.pageSize?this.Bb:a.pageSize;null==
this.Bb&&(this.Bb=c);a.pageSize=c;a.startIndex=this.Aa;var b=this;return new Promise(function(d,e){0<c?b.Sd.fetch(a).then(function(a){0<a.data.length?b.Uy(b.Aa+a.data.length-1,!0):b.Uy(-1,!0);d(a)},function(a){e(a)}):d(null)})};a.f.j("PagingTableDataSource.prototype.fetch",{fetch:a.Na.prototype.fetch});a.Na.prototype.get=function(a,c){return this.Sd.get(a,c)};a.f.j("PagingTableDataSource.prototype.get",{get:a.Na.prototype.get});a.Na.prototype.getCapability=function(a){return this.Sd.getCapability(a)};
a.f.j("PagingTableDataSource.prototype.getCapability",{getCapability:a.Na.prototype.getCapability});a.Na.prototype.on=function(g,c){var b=this,d=this.Sd;if(g==a.ha.aa.SYNC){var e=function(a){b.VFa(a,c)};this.hs.push({eventType:g,eventHandler:c,wrappedEventHandler:e});d.on(g,e)}else if(g==a.ha.aa.ADD||g==a.ha.aa.REMOVE||g==a.ha.aa.CHANGE)e=function(a){b.IFa(a,c)},this.hs.push({eventType:g,eventHandler:c,wrappedEventHandler:e}),d.on(g,e);else if(g==a.ha.aa.REFRESH||g==a.ha.aa.RESET)e=function(a){b.Aa=
0;c(a)},this.hs.push({eventType:g,eventHandler:c,wrappedEventHandler:e}),d.on(g,e);else if(g==a.zd.aa.PAGE||g==a.zd.aa.BEFOREPAGE||g==a.zd.aa.PAGECOUNT)a.Na.O.on.call(this,g,c);else d.on(g,c)};a.f.j("PagingTableDataSource.prototype.on",{on:a.Na.prototype.on});a.Na.prototype.off=function(g,c){g!=a.zd.aa.PAGE&&g!=a.zd.aa.PAGECOUNT||a.Na.O.off.call(this,g,c);var b=this.Sd;if(null!=this.hs){var d=this.hs.length,e;for(e=0;e<d;e++)if(this.hs[e].eventType==g&&this.hs[e].eventHandler==c){b.off(g,this.hs[e].wrappedEventHandler);
this.hs.splice(e,1);break}}b.off(g,c)};a.f.j("PagingTableDataSource.prototype.off",{off:a.Na.prototype.off});a.Na.prototype.sort=function(a){return this.Sd.sort(a)};a.f.j("PagingTableDataSource.prototype.sort",{sort:a.Na.prototype.sort});a.Na.prototype.totalSize=function(){return this.Sd.totalSize()};a.f.j("PagingTableDataSource.prototype.totalSize",{totalSize:a.Na.prototype.totalSize});a.Na.prototype.totalSizeConfidence=function(){return this.Sd.totalSizeConfidence()};a.f.j("PagingTableDataSource.prototype.totalSizeConfidence",
{totalSizeConfidence:a.Na.prototype.totalSizeConfidence});a.Na.prototype.uN=function(){return 0<this.Bb?Math.floor(this.Aa/this.Bb):0};a.Na.prototype.IFa=function(a,c){var b=[],d;for(d=0;d<a.indexes.length;d++){var e=a.indexes[d];void 0!==e&&("page"==this.SF&&(e-=this.Aa),(0>e||e>=this.Aa+this.Bb)&&b.push(d))}if(0<b.length)for(b.sort(function(a,b){return a-b}),d=b.length-1;0<=d;d--)a.data.splice(b[d],1),a.indexes.splice(b[d],1),a.keys.splice(b[d],1);0<a.indexes.length&&this.Uy(a.indexes[a.indexes.length-
1],!1);a.startIndex=this.Aa;c(a)};a.Na.prototype.VFa=function(g,c){g.startIndex!=this.Aa&&(this.Aa=g.startIndex);0<g.data.length?this.Uy(g.startIndex+g.data.length-1,!0):this.Uy(-1,!0);if("page"==this.SF){var b={};a.uc.fe(b,g);b.startIndex=0;c(b)}else c(g)};a.Na.prototype.Uy=function(a,c){this.Zl=c?a:a>this.Zl?a:this.Zl;var b=this.totalSize();0<b&&(this.Zl=this.Zl>b-1?b-1:this.Zl)};a.Na.aa={ADD:"add",REMOVE:"remove",RESET:"reset",SYNC:"sync",REFRESH:"refresh",SORT:"sort"};o_("PagingTableDataSource.EventType",
a.Na.aa,a);a.zd=function(){};o_("PagingModel",a.zd,a);a.zd.prototype.getPage=function(){};a.f.j("PagingModel.prototype.getPage",{getPage:a.zd.prototype.getPage});a.zd.prototype.setPage=function(){};a.f.j("PagingModel.prototype.setPage",{setPage:a.zd.prototype.setPage});a.zd.prototype.getStartItemIndex=function(){};a.f.j("PagingModel.prototype.getStartItemIndex",{getStartItemIndex:a.zd.prototype.getStartItemIndex});a.zd.prototype.getEndItemIndex=function(){};a.f.j("PagingModel.prototype.getEndItemIndex",
{getEndItemIndex:a.zd.prototype.getEndItemIndex});a.zd.prototype.getPageCount=function(){};a.f.j("PagingModel.prototype.getPageCount",{getPageCount:a.zd.prototype.getPageCount});a.zd.prototype.totalSize=function(){};a.f.j("PagingModel.prototype.totalSize",{totalSize:a.zd.prototype.totalSize});a.zd.prototype.totalSizeConfidence=function(){};a.f.j("PagingModel.prototype.totalSizeConfidence",{totalSizeConfidence:a.zd.prototype.totalSizeConfidence});a.zd.aa={BEFOREPAGE:"beforePage",PAGE:"page",PAGECOUNT:"pageCount"};
o_("PagingModel.EventType",a.zd.aa,a)});