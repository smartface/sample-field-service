/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","knockout","jquery","ojs/ojcomponentcore","ojs/ojcolor","ojs/ojslider","jqueryui-amd/widgets/draggable","ojs/ojtouchproxy","ojs/ojeditablevalue"],function(a,g,c){(function(){function b(a){var b;b=a.cD();var c=a.VC(),g=a.TC();b/=255;var c=c/255,g=g/255,k=Math.max(b,c,g),l=Math.min(b,c,g),m,p=(k+l)/2;if(k==l)m=l=0;else{var t=k-l,l=.5<p?t/(2-k-l):t/(k+l);switch(k){case b:m=(c-g)/t+(c<g?6:0);break;case c:m=(g-b)/t+2;break;case g:m=(b-c)/t+4}m/=6}b=[m,l,p];b[0]*=360;b[1]*=100;b[2]*=
100;b.push(a.SC());return b}a.ab("oj.ojColorSpectrum",c.oj.editableValue,{widgetEventPrefix:"oj",defaultElement:"\x3cinput\x3e",options:{value:null,rawValue:null,disabled:!1},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var b=null;switch(a.subId){case "oj-spectrum":b=this.Lm[0];break;case "oj-spectrum-thumb":b=this.cf[0];break;case "oj-hue-slider-bar":b=this.Kl.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-hue-slider-bar-value":b=this.Kl.ojSlider("getNodeBySubId",
{subId:"oj-slider-bar-value"});break;case "oj-hue-slider-thumb":b=this.Kl.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"});break;case "oj-opacity-slider-bar":b=this.Jl.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-opacity-slider-bar-value":b=this.Jl.ojSlider("getNodeBySubId",{subId:"oj-slider-bar-value"});break;case "oj-opacity-slider-thumb":b=this.Jl.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"})}return b},getSubIdByNode:function(a){if(!a)return null;a=c(a);var b=
null,f;a.hasClass("oj-colorspectrum-spectrum")?b="oj-spectrum":a.hasClass("oj-colorspectrum-thumb")?b="oj-spectrum-thumb":(f=a.closest(".oj-slider"),f=f.hasClass("oj-slider-vertical")?"hue":"opacity",a.hasClass("oj-slider-bar")?b="oj-"+f+"-slider-bar":a.hasClass("oj-slider-bar-value")?b="oj-"+f+"-slider-bar-value":a.hasClass("oj-slider-thumb")&&(b="oj-"+f+"-slider-thumb"));return{subId:b}},_destroy:function(){this.Pg&&(this.uya(),this.jAa(),this.AKa(),this.Pg.removeClass("oj-colorspectrum"),this.wx());
this._super()},_ComponentCreate:function(){this._super();this.zGa()},Qg:function(){this._super();var b=this.VK();b?(b=b.attr("id"))?this.cf.attr("aria-labelledby",b):a.C.warn("JET Color Spectrum: The label for this component needs an id in order to be accessible"):(b=this.element.attr("aria-label"))&&this.cf.attr("aria-label",b)},_setOption:function(a,b,c){switch(a){case "value":this.S0(b);break;case "disabled":this.TH(b,!0)}this._super(a,b,c)},Sl:function(b,c){if("string"===typeof b)try{b=new a.o(b)}catch(f){a.C("ojColorSpectrum: invalid rawValue ("+
b+"), defaulting to black"),b=a.o.BLACK}var g={};g._context={originalEvent:c,yd:!0,kb:!0,readOnly:!0};this.Sya(this.options.rawValue,b)||this.option("rawValue",b,g)},Sya:function(a,b){return a.cD()===b.cD()&&a.VC()===b.VC()&&a.TC()===b.TC()&&a.SC()===b.SC()},mM:function(b,c){var f=c instanceof a.o;return b instanceof a.o&&f&&b.isEqual(c)},TH:function(a,b){var c=!b||b&&a!==this.cq;c&&(this.YAa(!a),a?(this.element.addClass("oj-disabled"),this.eha(!1)):(this.element.removeClass("oj-disabled"),this.eha(!0)),
this.cq=a);return c},S0:function(b){b instanceof a.o&&!this.mM(this.xf,b)&&(this.vja(b),this.Uja(this.rq,!0),this.Uja(this.uo,!1),this.W0(this.rq,this.hC,this.RB,this.uo,!0))},Cha:function(b,e){var f,g,k,l,m;if(this.qka&&("rawValue"==e.option||"value"==e.option)&&void 0!==e.value&&("value"==e.option&&(this.wga=!!b.originalEvent),g=c(b.target),f=g.hasClass("oj-colorspectrum-hue"),g=g.hasClass("oj-colorspectrum-alpha"),f||g)){g=this.rq;k=this.hC;l=this.RB;m=this.uo;f?(g=e.value,this.JP(g,k,l),this.W0(g,
k,l,m,!1)):(m=e.value,this.MH(g,k,l,m));f=new a.o({h:g,s:k,l:l,a:m});if(b.originalEvent||this.wga)this.wga=!1,"rawValue"===e.option?this.Sl(f,b):"value"===e.option&&this.dc(f,b);this.vja(f)}},Uja:function(a,b){(b?this.Kl:this.Jl).ojSlider("option","value",a)},W0:function(a,b,c,g,k){this.Lm.css("background-color","hsl("+a+", 100%, 50%)");k&&(k=this.uDa(b,c),this.kC(k.x,k.y));this.MH(a,b,c,g)},xMa:function(){var b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)";
switch(a.Ra.qm().browser){case a.Ra.zi.$J:b="moz";break;default:b="webkit";break;case a.Ra.zi.mE:b="ms"}b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)".replace(/___/g,b);this.Lm.css("backgroundImage",b)},kC:function(a,b){isNaN(a)||(this.rv=a);isNaN(b)||(this.tv=b);this.qha(0,0)},uDa:function(a,b){var c=Math.min(a/100*this.Ms,this.Ms),g=this.Vo-Math.min(b/
100*this.Vo,this.Vo);return{x:Math.round(c),y:Math.round(g)}},qha:function(a,b){var c,g;c=this.rv+a;g=this.tv+b;0>c&&(c=0);0>g&&(g=0);c>=this.Ms&&(c=this.Ms-1);g>=this.Vo&&(g=this.Vo-1);this.rv=c;this.tv=g;c=c-this.Qk+"px";g=g-this.Qk+"px";this.cf[0].style.left=c;this.cf[0].style.top=g},WMa:function(b){if(!this.cq){var c=this.Lm.offset(),f=b.pageX-c.left,c=b.pageY-c.top,g,k,l,f=Math.round(f),c=Math.round(c);g=this.HY(f,c);k=g.kS;l=g.h4;g=this.rq;this.JP(g,k,l);var m=new a.o({h:g,s:k,l:l,a:this.uo});
this.Sl(m,b);this.dc(m,b);this.MH(g,k,l,this.uo);this.xf=m;this.Tja(k,l);this.kC(f,c);this.cf.focus()}},MHa:function(a){var b,c,g,k=1;this.Qga=(new Date).getTime();0>this.Su&&(this.Su=this.Qga,this.Pga=0);b=this.Qga-this.Su;this.Pga++;if(1400<b||25<this.Pga)k=3;c=g=0;b=a.keyCode;if(40==b)g=k;else if(38==b)g=-k;else if(39==b)c=k;else if(37==b)c=-k;else if(36==b)this.kC(0,0),this.Su=-1;else if(35==b)this.kC(this.Ms-1,this.Vo-1),this.Su=-1;else if(33==b)this.kC(NaN,0),this.Su=-1;else if(34==b)this.kC(NaN,
this.Vo-1),this.Su=-1;else return;this.qha(c,g);this.lfa(a,this.rv,this.tv);a.preventDefault();return!1},OHa:function(a){this.Su=-1;var b=this.HY(this.rv,this.tv);this.MH(this.rq,b.kS,b.h4,this.uo);this.dc(this.options.rawValue,a)},IGa:function(){this.Lm[0].getBoundingClientRect();this.w1||(this.w1=this.nNa.bind(this));this.cf.draggable({drag:this.w1,stop:this.w1})},eha:function(a){this.cf.draggable(a?"enable":"disable")},nNa:function(a,b){var c,g,k,l;b.position.left<-this.Qk?(b.position.left=-this.Qk,
c=0):b.position.left+this.Qk>=this.Ms&&(b.position.left=this.Ms-1-this.Qk,g=this.Ms-1);b.position.top<-this.Qk?(b.position.top=-this.Qk,g=0):b.position.top+this.Qk>=this.Vo&&(b.position.top=this.Vo-1-this.Qk,g=this.Vo-1);k=this.cf.offset();l=this.Lm.offset();0!=c&&(c=k.left+this.Qk-l.left);0!=g&&(g=k.top+this.Qk-l.top);if(this.rv!==c||this.tv!==g)"drag"===a.type?(this.rv=c,this.tv=g):(c=this.rv,g=this.tv),this.lfa(a,c,g)},lfa:function(b,c,f){var g,k,l=!1;g=this.rq;f=this.HY(c,f);c=f.kS;f=f.h4;this.JP(g,
c,f);k=new a.o({h:g,s:c,l:f,a:this.uo});this.Sl(k,b);"dragstop"===b.type&&(this.dc(k,b.originalEvent),l=!0);this.xf=k;this.Tja(c,f);l&&this.MH(g,c,f,this.uo)},HY:function(a,b){return{kS:a/(this.Ms-1)*100,h4:100-b/(this.Vo-1)*100}},JP:function(a,b,c){var g="hsla("+a+","+b+"%,"+c+"%, 0)";b="hsla("+a+","+b+"%,"+c+"%, 1.0)";this.MB&&(a=b,b=g,g=a);this.dX=a="linear-gradient(90deg, "+g+", "+b+"),"+this.BV;this.DK.css("background",a)},qDa:function(a,b,c,g){var k="number"===typeof g&&1>g;a=Math.round(a);
b=Math.round(100*b)/100;c=Math.round(100*c)/100;return a="hsl"+(k?"a(":"(")+(a+", "+b+"%, "+c+"%"+(k?","+g:"")+")")},Tja:function(a,b){this.hC=a;this.RB=b},vja:function(a){a&&(this.xf=a,a=b(a),this.rq=a[0],this.hC=a[1],this.RB=a[2],this.uo=a[3])},MH:function(a,b,c,g){this.cf.attr("aria-valuetext",this.qDa(a,b,c,g))},zGa:function(){this.BG();this.hb()},hb:function(){this.Pg.append(this.WG);this.Pg.addClass("oj-colorspectrum");c(".oj-colorspectrum-hue").uniqueId();c(".oj-colorspectrum-alpha").uniqueId();
this.Pg.find(".oj-colorspectrum-container");this.Kl=this.Pg.find(".oj-colorspectrum-hue");this.Jl=this.Pg.find(".oj-colorspectrum-alpha");this.Lm=this.Pg.find(".oj-colorspectrum-spectrum");this.cf=this.Pg.find(".oj-colorspectrum-thumb");this.Qk=this.cf[0].offsetWidth/2;0>=this.Qk&&(this.Qk=this.cf.width()/2);this.fy=a.Q.Qe();this.Ms=this.Lm.width();this.Vo=this.Lm.height();this.cf.attr("aria-describedby",this.Pg.find(".oj-colorspectrum-thumb-description").uniqueId().attr("id"));this.BV="url('"+a.oa.ub("common/images/spectrum-opacity-slider-bg.png")+
"')";this.BV=this.BV.replace("js","css");var d=this.cq?!0:!1,e=b(this.xf);this.rq=e[0];this.hC=e[1];this.RB=e[2];this.uo=e[3];this.qka=!1;this.Kl.ojSlider({max:360,min:0,step:1,value:this.rq,orientation:"vertical",optionChange:this.Cha.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal","");this.Jl.ojSlider({max:1,min:0,step:.01,value:this.uo,orientation:"horizontal",optionChange:this.Cha.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal",
"");this.GGa();this.xMa();this.W0(this.rq,this.hC,this.RB,this.uo,!0);this.Lm.click(this.WMa.bind(this));this.IGa();this.TH(d);this.cf.keydown(this.MHa.bind(this));this.cf.keyup(this.OHa.bind(this));this.Lm.focus(this.OIa.bind(this));this._focusable({element:this.cf,HWa:!0});a.Q.Qe()&&this.c1(this.cf)},OIa:function(){this.cf.focus();return!1},GGa:function(){var a={subId:"oj-slider-bar"};this.EK=c(this.Kl.ojSlider("getNodeBySubId",a));this.DK=c(this.Jl.ojSlider("getNodeBySubId",a));a.rXa="oj-slider-bar-value";
c(this.Kl.ojSlider("getNodeBySubId",a));c(this.Jl.ojSlider("getNodeBySubId",a));this.EK.css("background","linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)");this.eX="linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)";this.JP(this.rq,this.hC,this.RB);this.qka=!0},BG:function(){this.HV();this.tv=this.rv=0;var a=this.$f(this.R("labelHue")),b=this.$f(this.R("labelOpacity"));this.WG=
["\x3cdiv class\x3d'oj-colorspectrum-container'\x3e\x3cdiv class\x3d'oj-colorspectrum-spectrum' tabindex\x3d'-1' style\x3d'position:relative'\x3e\x3cdiv class\x3d'oj-colorspectrum-thumb' role\x3d'slider' aria-describedby\x3d'' style\x3d'position:absolute;top:-9999px;left:-9999px;' tabIndex\x3d'0'\x3e\x3c/div\x3e\x3c/div\x3e","\x3cdiv class\x3d'oj-colorspectrum-thumb-description oj-helper-hidden-accessible'\x3e"+this.$f(this.R("labelThumbDesc"))+"\x3c/div\x3e","\x3cinput class\x3d'oj-colorspectrum-hue' aria-label\x3d'"+
a+"'\x3e\x3c/input\x3e","\x3cinput class\x3d'oj-colorspectrum-alpha' aria-label\x3d'"+b+"'\x3e\x3c/input\x3e","\x3c/div\x3e"].join("");this.Su=-1;this.MB="rtl"===this.sd()},HV:function(){var b=this.options,e;this.Pg=c(this.element);this.cq=!1;e=b.value;e instanceof a.o||(e=null);this.xf=e?e:a.o.BLACK;b.rawValue=this.xf;e=b.disabled;this.cq="boolean"===typeof e?e:!1},YAa:function(a){var b=!a;a?(this.Kl.ojSlider("option","disabled",b),this.Jl.ojSlider("option","disabled",b),b={subId:"oj-slider-bar"},
this.Kl=this.Pg.find(".oj-colorspectrum-hue"),this.Jl=this.Pg.find(".oj-colorspectrum-alpha"),this.EK=c(this.Kl.ojSlider("getNodeBySubId",b)),this.DK=c(this.Jl.ojSlider("getNodeBySubId",b)),this.dX&&this.DK.css("background",this.dX),this.eX&&this.EK.css("background",this.eX)):((a=this.EK.css("background"))&&0<a.length&&(this.eX=a),(a=this.DK.css("background"))&&0<a.length&&(this.dX=a),this.Kl.ojSlider("option","disabled",b),this.Jl.ojSlider("option","disabled",b))},jAa:function(){this.Kl.ojSlider("destroy");
this.Jl.ojSlider("destroy")},AKa:function(){this.Pg.empty()},uya:function(){this.Lm.off("click");this.cf.off("mousedown");this.cf.off("keydown");this.cf.off("keyup");this.hI&&this.t1(this.cf)},wx:function(){this.WG=this.Pg=this.Kl=this.Jl=this.Lm=this.cf=null},c1:function(b){this.hI=a.wg.t2(b)},t1:function(b){a.wg.Z4(b)},_GetMessagingLauncherElement:function(){return this.element},ag:function(){return this.cf},Yt:function(){return this.xf},uk:function(b){this.xf="string"===typeof b?new a.o(b):b},
di:function(){return this.xf.toString()},_GetDefaultStyleClass:function(){return"oj-colorspectrum"},$f:function(a){return c("\x3cspan\x3e"+a+"\x3c/span\x3e").text()}})})()});