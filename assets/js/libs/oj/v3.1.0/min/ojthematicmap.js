/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojdvt-base","ojs/internal-deps/dvt/DvtThematicMap"],function(a,g,c,b,d){a.ab("oj.ojThematicMap",g.oj.dvtBaseComponent,{widgetEventPrefix:"oj",options:{load:null},uba:"",VG:[],K$:"resources/internal-deps/dvt/thematicMap/basemaps/",Aka:{ar:"ar",cs:"cs",da:"da",de:"de",el:"el",es:"es",fi:"fi",fr:"fr","fr-ca":"fr_CA",he:"iw",hu:"hu",it:"it",ja:"ja",ko:"ko",nl:"nl",no:"no",pl:"pl",pt:"pt_BR","pt-pt":"pt",ro:"ro",ru:"ru",sk:"sk",sv:"sv",th:"th",tr:"tr",
"zh-hans":"zh_CN","zh-hant":"zh_TW"},_ComponentCreate:function(){this._super();this.ux=[];this.Ufa=!1;this.$A=[]},vh:function(a,b,c){return d.ThematicMap.newInstance(a,b,c)},Ll:function(a){var b=a.subId;"oj-thematicmap-area"==b?b=a.dataLayer+":area["+a.index+"]":"oj-thematicmap-marker"==b?b=a.dataLayer+":marker["+a.index+"]":"oj-thematicmap-link"==b?b=a.dataLayer+":link["+a.index+"]":"oj-thematicmap-tooltip"==b&&(b="tooltip");return b},Ei:function(a){var b={};0<a.indexOf(":area")?(b.subId="oj-thematicmap-area",
b.dataLayer=a.substring(0,a.indexOf(":")),b.index=this.Ol(a)):0<a.indexOf(":marker")?(b.subId="oj-thematicmap-marker",b.dataLayer=a.substring(0,a.indexOf(":")),b.index=this.Ol(a)):0<a.indexOf(":link")?(b.subId="oj-thematicmap-link",b.dataLayer=a.substring(0,a.indexOf(":")),b.index=this.Ol(a)):"tooltip"==a&&(b.subId="oj-thematicmap-tooltip");return b},vg:function(){var a=this._super();a.push("oj-thematicmap");return a},qk:function(){var a=this._super();a["oj-dvtbase oj-thematicmap"]={path:"animationDuration",
property:"animation-duration"};a["oj-thematicmap-arealayer"]=[{path:"styleDefaults/areaStyle",property:"CSS_BACKGROUND_PROPERTIES"},{path:"styleDefaults/labelStyle",property:"CSS_TEXT_PROPERTIES"}];a["oj-thematicmap-area"]={path:"styleDefaults/dataAreaDefaults/borderColor",property:"border-top-color"};a["oj-thematicmap-area oj-hover"]={path:"styleDefaults/dataAreaDefaults/hoverColor",property:"border-top-color"};a["oj-thematicmap-area oj-selected"]=[{path:"styleDefaults/dataAreaDefaults/selectedInnerColor",
property:"border-top-color"},{path:"styleDefaults/dataAreaDefaults/selectedOuterColor",property:"border-bottom-color"}];a["oj-thematicmap-marker"]=[{path:"styleDefaults/dataMarkerDefaults/labelStyle",property:"CSS_TEXT_PROPERTIES"},{path:"styleDefaults/dataMarkerDefaults/color",property:"background-color"},{path:"styleDefaults/dataMarkerDefaults/opacity",property:"opacity"},{path:"styleDefaults/dataMarkerDefaults/borderColor",property:"border-top-color"}];a["oj-thematicmap-link"]={path:"styleDefaults/linkDefaults/color",
property:"color"};a["oj-thematicmap-link oj-hover"]={path:"styleDefaults/linkDefaults/_hoverColor",property:"color"};a["oj-thematicmap-link oj-selected"]={path:"styleDefaults/linkDefaults/_selectedColor",property:"border-color"};return a},Nl:function(){return["load","optionChange"]},_setOptions:function(b,c){var d=Object.keys(b).length,g=b.areaLayers,l=this.options.areaLayers,m=b.pointDataLayers;if(1==d&&g&&l&&0<l.length)for(d=0;d<g.length;d++){var m=g[d],p=l[d],t=!0,s;for(s in m)"areaDataLayer"!=
s&&m[s]!=p[s]&&(t=t&&!1);t&&!a.f.Zk(p.areaDataLayer,m.areaDataLayer)&&this.$A.push({options:m.areaDataLayer,parentLayer:m.layer,isADL:!0})}else if(1==d&&m&&this.options.pointDataLayers&&0<this.options.pointDataLayers.length)for(d=0;d<m.length;d++)a.f.Zk(this.options.pointDataLayers[d],m[d])||this.$A.push({options:m[d],parentLayer:m[d].id,isADL:!1});this._super(b,c)},Rr:function(){this._super();var b=this.options.tooltip,c=b?b.renderer:null;c&&(this.options._tooltip={renderer:function(b){var d=b.tooltip;
try{return c(b)||d}catch(e){return a.C.warn("Showing default tooltip. "+e),d}},_templateCleanup:b._templateCleanup});var d=this.options.areaLayers;if(d)for(b=0;b<d.length;b++){var g=d[b].areaDataLayer;if(g){var l=g._templateRenderer;l&&(g.renderer=this.hU(l,"area"))}}if(d=this.options.pointDataLayers)for(b=0;b<d.length;b++)(g=d[b])&&(l=g._templateRenderer)&&(g.renderer=this.hU(l,"point"));this.options._contextHandler=this.VX()},Ug:function(){this.BA();var a=this.options.areaLayers;if(!this.options.basemap||
!a||1>a.length)this.IE();else{this.YHa();for(a=0;a<this.ux.length;a++)if(!this.VG[this.ux[a]])return;this.ux=[];this.UNa();if(this.Ufa&&0<this.$A.length){if(this.xg.isReadyToRender()){for(a=0;a<this.$A.length;a++){var b=this.$A[a],c=b.isADL;c?this.ZT("area"):this.ZT("point");this.Ia.updateLayer(b.options,b.parentLayer,c)}this.$A=[]}}else this._super(),this.Ufa=!0;this._trigger("load",null,null)}},VX:function(){var b=this;return function(c,d,g,l,m){c={component:a.Components.md(b.element),parentElement:c,
rootElement:d,data:g,state:l,previousState:m,id:g.id,label:g.label,color:g.color,location:g.location,x:g.x,y:g.y};return b.Mr(c)}},renderDefaultHover:function(a){a.previousState&&a.state.hovered==a.previousState.hovered||this.Ia.processDefaultHoverEffect(a.id,a.state.hovered)},renderDefaultSelection:function(a){a.previousState&&a.state.selected==a.previousState.selected||this.Ia.processDefaultSelectionEffect(a.id,a.state.selected)},renderDefaultFocus:function(a){a.previousState&&a.state.focused==
a.previousState.focused||this.Ia.processDefaultFocusEffect(a.id,a.state.focused)},YHa:function(){var b=this.options.basemap;if(b){var c=a.oa.fj();c!==this.uba&&(this.uba=c,this.VG=[]);var d=this.options.areaLayers;if(d)for(var g=0;g<d.length;g++){var l=d[g].layer;l&&this.Xga(b,l,c)}d=this.options.pointDataLayers;!this.options.mapProvider&&d&&0<d.length&&this.Xga(b,"cities",c)}},$ga:function(b,c){if(!this.VG[b]){var d=this,k=g.getScript(a.oa.ub(b),function(){d.VG[b]=!0;d.Ug()});c&&k.fail(function(){d.VG[b]=
!0;d.Ug()})}},Xga:function(b,c,g){var k=!0;try{k=0<Object.keys(d.DvtBaseMapManager.getLayerIds(b,c)).length}catch(l){k=!1}k||((k=this.options.mapProvider)?a.xb.gQa(b,c,k):(k=this.K$+"ojthematicmap-"+b+"-"+c+".js",-1==this.ux.indexOf(k)&&(this.ux.push(k),this.$ga(k,!1))));if(-1===g.indexOf("en"))for(k=g.toLowerCase().split("-"),g=[k[0]],1<k.length&&g.unshift(k[0]+"-"+k[1]),2<k.length&&g.unshift(k[0]+"-"+k[2],k[0]+"-"+k[1]+"-"+k[2]),b=b.charAt(0).toUpperCase()+b.slice(1),c=c.charAt(0).toUpperCase()+
c.slice(1),b=this.K$+"resourceBundles/"+b+c+"Bundle_",c=0;c<g.length;c++)if(this.Aka[g[c]]){b=b+this.Aka[g[c]]+".js";-1==this.ux.indexOf(b)&&(this.ux.push(b),this.$ga(b,!0));break}},Pm:function(a){if("selection"===a.type){var b={},c=a.clientId;b[c]=a.selection;if(this.options.selection)for(var d in this.options.selection)c!==d&&(b[d]=this.options.selection[d]);this.We("selection",b)}else this._super(a)},Cj:function(){var a=this.options.translations,b=this._super();b["DvtUtilBundle.THEMATIC_MAP"]=
a.componentName;return b},UNa:function(){var a=this.options.selection;if(a){var b=this.options.pointDataLayers;if(b)for(var c=0;c<b.length;c++)a[b[c].id]&&(b[c].selection=a[b[c].id]);if(b=this.options.areaLayers)for(c=0;c<b.length;c++){var d=b[c].areaDataLayer;d&&a[d.id]&&(d.selection=a[d.id])}}},getArea:function(a,b){return this.Ia.getAutomation().getData(a,"area",b)},getMarker:function(a,b){return this.Ia.getAutomation().getData(a,"marker",b)},getLink:function(a,b){return this.Ia.getAutomation().getData(a,
"link",b)},getContextByNode:function(a){return(a=this.getSubIdByNode(a))&&"oj-thematicmap-tooltip"!==a.subId?a:null},Ml:function(){return{areaLayers:["areaDataLayer/areas","areaDataLayer/markers"],pointDataLayers:["markers","links"]}},SK:function(){return{areaLayers:{areaDataLayer:{areas:!0,markers:!0}},pointDataLayers:{markers:!0,links:!0}}},j8:function(a){var b=this.options.basemap;a=a.layer?a.layer:"cities";return{basemap:b,layer:a,ids:d.DvtBaseMapManager.getLayerIds(b,a)}}});a.xb={};a.xb.fL="DvtBaseMapManager";
a.xb.R9="_UNPROCESSED_MAPS";a.xb.Ur="type";a.xb.eua="geometry";a.xb.yta="coordinates";a.xb.aua="features";a.xb.vva="properties";a.xb.jwa="FeatureCollection";a.xb.FVa="GeometryCollection";a.xb.iwa="Feature";a.xb.P9="Polygon";a.xb.O9="MultiPolygon";a.xb.Qm="id";a.xb.Pva="shortLabel";a.xb.Eua="longLabel";a.xb.gQa=function(b,c,d){var g={},l={},m=d.geo,p=d.propertiesKeys||{};d=m[a.xb.Ur];if(d===a.xb.jwa)m[a.xb.aua].forEach(function(b){a.xb.bqa(b,p,l,g)});else if(d===a.xb.iwa)a.xb.bqa(m,p,l,g);else{a.C.error("GeoJSON type of "+
d+" is not supported. Only Feature and FeatureCollection types are supported.");return}0===Object.keys(l).length?a.C.error("No valid Features found in GeoJSON."):(window[a.xb.fL]||(window[a.xb.fL]={},window[a.xb.fL][a.xb.R9]=[[],[],[]]),window[a.xb.fL][a.xb.R9][0].push([b,c,g,l,null,null,0]))};a.xb.bqa=function(b,c,d,g){var l=b[a.xb.vva];b=b[a.xb.eua];if(a.xb.ySa(b)){var m=l[c[a.xb.Qm]];if(m){var p=l[c[a.xb.Pva]];c=l[c[a.xb.Eua]];if(p||c)g[m]=[p,c];d[m]=a.xb.hQa(b)}else a.C.warn("No 'id' value found in the mapProvider.propertiesKey object. A Feature's 'properties' object must have an id in the field specified by the mapProvider.propertiesKey.id value.")}else a.C.warn("A geometry of type "+
b[a.xb.Ur]+" is not supported and will be skipped.")};a.xb.ySa=function(b){b=b[a.xb.Ur];return b===a.xb.P9||b===a.xb.O9?!0:!1};a.xb.hQa=function(b){var c="",d=b[a.xb.Ur];b=b[a.xb.yta];d===a.xb.P9?c=a.xb.gqa(b):d===a.xb.O9&&b.forEach(function(b){c+=a.xb.gqa(b)});return c};a.xb.gqa=function(b){var c="";b.forEach(function(b){c+=a.xb.DSa(b)});return c};a.xb.DSa=function(a){var b,c,d,g="M";a&&a.forEach(function(a){var e=a[0];a=-a[1];if("M"===g)c=e,d=a,g="x",b="M"+e+" "+a;else{var t=e-c,s=a-d;if("l"==g){if(c==
e){g="v";d=a;b=b+g+s;return}if(d==a){g="h";c=e;b=b+g+t;return}b=b+" "+t+" "+s}else g="l",b=b+"l"+t+" "+s;c=e;d=a}});return b+"Z"};a.U.qb("oj-thematic-map","dvtBaseComponent",{properties:{animationDuration:{type:"number|string"},animationOnDisplay:{type:"string"},animationOnMapChange:{type:"string"},areaLayers:{type:"Array\x3cobject\x3e"},basemap:{type:"string"},hiddenCategories:{type:"Array\x3cstring\x3e"},highlightedCategories:{type:"Array\x3cstring\x3e"},highlightMatch:{type:"string"},hoverBehavior:{type:"string"},
initialZooming:{type:"string"},mapProvider:{type:"object",properties:{geo:{type:"object"},propertiesKeys:{type:"object"}}},markerZoomBehavior:{type:"string"},maxZoom:{type:"number"},panning:{type:"string"},pointDataLayers:{type:"Array\x3cobject\x3e"},selection:{type:"object"},styleDefaults:{type:"object",properties:{areaStyle:{type:"string|object"},dataAreaDefaults:{type:"object",properties:{dataAreaDefaults:{borderColor:{type:"string"},drilledInnerColor:{type:"string"},drilledOuterColor:{type:"string"},
hoverColor:{type:"string"},selectedInnerColor:{type:"string"},selectedOuterColor:{type:"string"}}}},dataMarkerDefaults:{type:"object",properties:{dataMarkerDefaults:{borderColor:{type:"string"},borderStyle:{type:"string"},borderWidth:{type:"number"},color:{type:"string"},height:{type:"number"},labelStyle:{type:"string"},opacity:{type:"number"},shape:{type:"string"},width:{type:"number"}}}},hoverBehaviorDelay:{type:"number|string"},labelStyle:{type:"string"},linkDefaults:{type:"object",properties:{linkDefaults:{color:{type:"string"},
width:{type:"number"}}}}}},tooltip:{type:"object",properties:{renderer:{}}},tooltipDisplay:{type:"string"},touchResponse:{type:"string"},translations:{properties:{componentName:{type:"string"}}},zooming:{type:"string"}},methods:{getArea:{},getContextByNode:{},getLink:{},getMarker:{},renderDefaultFocus:{},renderDefaultHover:{},renderDefaultSelection:{}},extension:{nb:"ojThematicMap"}});a.U.register("oj-thematic-map",{metadata:a.U.getMetadata("oj-thematic-map")})});